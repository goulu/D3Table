<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>D3Table</title>
    <link rel="stylesheet" href="./table.css">
</head>
<body>
<h1>Table using D3.js and clusterize.js</h1>
The following table:
<ol>
    <li>dynamically loaded <span id="rows">many</span> rows, but only <span id="few">a few</span>
        &lt;TR&gt; are in the DOM, which makes scrolling very fast (try!)
    </li>
    <li>is sortable (click the headers)</li>
    <li>is filterable (try using <input id="filter">)</li>
    <li>scrolls smoothly to any row (try using <input id="search">)</li>
    <li>uses a custom format function (to change null values into "?")</li>
    <li>reacts to mouseover, mouseleave, click and dblclick events</li>
</ol>
<div class="table">
</div>
Thanks to:
<ul>
    <li>the fantastic D3js (V3)</li>
    <li>Clusterize.js (in fact it currently uses <a href="https://github.com/goulu/Clusterize.js">my fork of
        clusterize.js</a> which allows to specify a function providing data for each row
    </li>
    <li>https://github.com/jdorfman/awesome-json-datasets</li>
</ul>

<script src="./clusterize.js"></script>
<script src='http://d3js.org/d3.v3.js' type='text/javascript'></script>
<script src="./table.js" type='text/javascript'></script>
<script>
  var table = new Table(d3.select('.table'))
    .format(function (d) {
      return (d === null) ? "?" : d;
    })
    .filter(d3.select('#filter'))
    .on("mouseover", function (d, i) {
      this.select(d, i);
    })
    .on("mouseleave", function (d, i) {
      this.deselect(d, i);
    })
    .on("click", function (d, i) {
      this.select(d, i);
    })
    .on("dblclick", function (d, i) {
      this.deselect(d, i);
    });

  d3.json("https://raw.githubusercontent.com/prust/wikipedia-movie-data/master/movies.json", function (json) {
    table
      .header(Object.keys(json[0]))
      .data(json);
    d3.select('#rows').text(json.length);
    d3.select('#few').text(table.options.rows_in_cluster);
  });

  d3.select('#search').on("input", function () {
    let s = this.value.toLowerCase();
    let i = table.data().findIndex(function (d, i) {
      return table.findInRow(d, s) !== -1;
    });
    if (i>-1) {
      let d=table.data()[i]
      table.select(d);
      table.scrollTo(d);
    }
  });
</script>
</body>
</html>
